# Filename: api_documentation/schemas/modules/documentStoreSchemas.yaml
components:
  schemas:
    DocumentStoreStatusEnum:
      type: string
      enum: [EMPTY_SYNC, SYNC, SYNCING, STALE, NEW, UPSERTED, FAILED]
      description: "Status of a document store or its loader. EMPTY_SYNC refers to an empty store that is considered in sync."

    IDocumentStoreLoaderFileSchema: # Based on IDocumentStoreLoaderFile
      type: object
      properties:
        id: { type: string, description: "Internal ID of the file record." }
        name: { type: string, description: "Original name of the file." }
        mimePrefix: { type: string, description: "MIME type of the file, e.g., 'application/pdf'." }
        size: { type: integer, description: "Size of the file in bytes." }
        status: { $ref: '#/components/schemas/DocumentStoreStatusEnum', description: "Processing status of this file." }
        uploaded: { type: string, format: date-time, description: "Timestamp of when the file was uploaded/associated." }
      required: [id, name, mimePrefix, size, status, uploaded]

    IDocumentStoreLoaderSchema: # Based on IDocumentStoreLoader interface
      type: object
      properties:
        id: 
          type: string
          nullable: true
          description: "Instance ID of this specific loader configuration within the document store's 'loaders' array."
        loaderId:
          type: string
          nullable: true
          description: "Component name of the loader (e.g., 'pdfFile', 'cheerioWebScraper')."
        loaderName:
          type: string
          nullable: true
          description: "User-defined or default display name for this loader instance."
        loaderConfig:
          type: object
          additionalProperties: true
          description: "Configuration parameters specific to the loader defined by 'loaderId'. Structure is dynamic. Stored as JSON string in DB, parsed to object in response."
          example: {"filePath": "uploads/somefile.pdf"}
        splitterId:
          type: string
          nullable: true
          description: "Component name of the text splitter associated with this loader, if any."
        splitterName:
          type: string
          nullable: true
          description: "Display name of the associated text splitter."
        splitterConfig:
          type: object
          additionalProperties: true
          description: "Configuration parameters for the splitter. Structure is dynamic. Stored as JSON string in DB, parsed to object in response."
          nullable: true
        totalChunks:
          type: integer
          nullable: true
          description: "Total number of chunks produced by this loader/splitter combination."
        totalChars:
          type: integer
          nullable: true
          description: "Total number of characters processed by this loader/splitter."
        status:
          $ref: '#/components/schemas/DocumentStoreStatusEnum'
          nullable: true
          description: "Processing status of this loader instance."
        storeId: 
          type: string
          format: uuid
          nullable: true 
          description: "ID of the parent Document Store (contextual, may not be part of the direct loader object if nested)."
        files:
          type: array
          items:
            $ref: '#/components/schemas/IDocumentStoreLoaderFileSchema'
          nullable: true
          description: "List of files associated with this loader instance."
        source:
          type: string
          nullable: true
          description: "Derived source string for the loader (e.g., file name, URL)."
        credential:
          type: string
          format: uuid 
          nullable: true
          description: "ID of the credential used by this loader, if any."

    DocumentStoreWhereUsedSchema:
      type: object
      properties:
        id:
          type: string
          format: uuid
          description: "ID of the ChatFlow using this document store."
        name:
          type: string
          description: "Name of the ChatFlow using this document store."
      required: [id, name]

    DocumentStoreDTO: # Based on DocumentStoreDTO class and its fromEntity logic
      type: object
      properties:
        id: { type: string, format: uuid }
        name: { type: string }
        description: { type: string, nullable: true }
        status: { $ref: '#/components/schemas/DocumentStoreStatusEnum' }
        totalChars: { type: integer, description: "Calculated sum of characters from all loaders." }
        totalChunks: { type: integer, description: "Calculated sum of chunks from all loaders." }
        whereUsed:
          type: array
          items:
            $ref: '#/components/schemas/DocumentStoreWhereUsedSchema'
          description: "List of chatflows using this document store (ID and name)."
        vectorStoreConfig:
          type: object
          additionalProperties: true # Dynamic based on specific vector store component
          nullable: true
          description: "Parsed JSON object of the vector store configuration. Structure is dynamic."
        embeddingConfig:
          type: object
          additionalProperties: true # Dynamic based on specific embedding component
          nullable: true
          description: "Parsed JSON object of the embedding configuration. Structure is dynamic."
        recordManagerConfig:
          type: object
          additionalProperties: true # Dynamic based on specific recordManager component
          nullable: true
          description: "Parsed JSON object of the record manager configuration. Structure is dynamic."
        loaders:
          type: array
          items:
            $ref: '#/components/schemas/IDocumentStoreLoaderSchema'
          description: "Array of loader configurations within this document store. Each loader object includes a 'source' field derived by the DTO."
        createdDate: { type: string, format: date-time }
        updatedDate: { type: string, format: date-time }
      required: [id, name, status, totalChars, totalChunks, whereUsed, loaders, createdDate, updatedDate]

    DocumentStoreLoaderFullConfigResponse: # For GET /store-configs/:id/:loaderId
      type: object
      description: "Aggregated configurations for a specific loader within a document store."
      properties:
        loaderId:
          type: string
          description: "The component name of the loader (e.g., 'pdfFile', 'cheerioWebScraper')."
        loaderName:
          type: string
          description: "The user-defined or default display name of the loader instance."
        loaderConfig: 
          type: object
          additionalProperties: true 
          description: "Parsed JSON object of the loader's specific configuration parameters. Structure is dynamic based on the loaderId."
          example: {"url": "http://example.com", "limit": 3}
        splitterId: 
          type: string
          nullable: true
          description: "The component name of the splitter associated with this loader, if any."
        splitterName:
          type: string
          nullable: true
          description: "The display name of the splitter, if any."
        splitterConfig: 
          type: object
          additionalProperties: true 
          nullable: true
          description: "Parsed JSON object of the splitter's configuration parameters (if any). Structure is dynamic."
          example: {"chunkSize": 500, "chunkOverlap": 50}
        embeddingConfig: 
          type: object
          additionalProperties: true 
          nullable: true
          description: "Parsed JSON object of the embedding configuration from the parent Document Store. Structure is dynamic."
        vectorStoreConfig: 
          type: object
          additionalProperties: true 
          nullable: true
          description: "Parsed JSON object of the vector store configuration from the parent Document Store. Structure is dynamic."
        recordManagerConfig: 
          type: object
          additionalProperties: true 
          nullable: true
          description: "Parsed JSON object of the record manager configuration from the parent Document Store. Structure is dynamic."
      required:
        - loaderId
        - loaderName
        - loaderConfig

    INodeParamOptionSchema: # Based on INodeParams options
      type: object
      properties:
        label: { type: string }
        name: { type: string }
        description: { type: string, nullable: true }
      required: [label, name]

    INodeParamSchema: # Simplified based on INodeParams from flowise-components
      type: object
      properties:
        label: { type: string }
        name: { type: string }
        type: { type: string, description: "e.g., string, number, boolean, options, file, json, credential, asyncOptions" }
        description: { type: string, nullable: true }
        default: { type: string, nullable: true, description: "Can be of any type, represented as string here for flexibility." } # Actual type can vary
        options:
          type: array
          items:
            $ref: '#/components/schemas/INodeParamOptionSchema'
          nullable: true
        fileType: { type: string, nullable: true, description: "e.g., .pdf,.txt,.json" }
      required: [label, name, type]

    DocumentLoaderComponentDefinition: # Based on INode from flowise-components
      type: object
      description: "Definition of an available document loader component."
      properties:
        label: { type: string, description: "Display name of the loader." }
        name: { type: string, description: "Internal unique name/ID of the loader component." }
        version: { type: integer, default: 1, description: "Version of the component." }
        description: { type: string, nullable: true }
        type: { type: string, default: "DocumentLoader", description: "Component type, usually 'DocumentLoader'." }
        icon: { type: string, nullable: true, description: "Base64 encoded icon data URI or path." } # from iconSrc
        category: { type: string, description: "Category, e.g., 'Document Loaders'." }
        baseClasses: 
          type: array 
          items: { type: string }
          description: "Base classes this component inherits from."
        inputs: 
          type: array
          items:
            $ref: '#/components/schemas/INodeParamSchema'
          description: "Input parameters required by the loader."
      required: [label, name, version, type, category, baseClasses]
