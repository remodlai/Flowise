# Development Guidelines for Remodl AI Platform (AI Agent Focus)

## 1. Project Overview

-   Rule: The Remodl AI Platform is the primary system being developed.
-   Rule: This platform utilizes a **Remodl Core** instance (currently based on upstream Flowise v2.2.8, on `remodel-v2-base` branch) as an embedded engine for AI flow design and execution.
-   Rule: Key external technologies for the Remodl AI Platform include Supabase (business logic, multi-tenancy data) and Zuplo (API Gateway).
-   Rule: AI development tasks must be understood within the context of enhancing the Remodl AI Platform. **Remodl Core** modifications should serve this higher-level goal and be minimized where possible by leveraging platform layers (Supabase, Zuplo, custom Remodl UI).
-   Rule: The project uses TypeScript as the primary language, with Node.js for the backend (**Remodl Core** server) and React for the frontend (**Remodl Core** UI and Remodl UI).

## 2. Project Architecture

-   Rule: The codebase is a PNPM monorepo with primary packages located under the `packages/` directory. Refer to `pnpm-workspace.yaml`.
-   Rule: Builds and development tasks are orchestrated by Turborepo. Refer to `turbo.json` for pipeline definitions (e.g., `build` outputs to `dist/**` folders within packages).
-   Rule: The main Remodl AI Platform user interface WILL BE developed in a new, dedicated package: `packages/remodl-ui` (exact name TBD by user, after server API documentation is complete). This package will be a React application.
    -   *Example (Do):* Create new UI components for Application Management within `packages/remodl-ui`.
    -   *Example (Don't):* Implement Remodl platform-specific dashboards directly within `packages/ui` (the **Remodl Core** UI) without a clear strategy for separation or upstream compatibility.
-   Rule: The existing `packages/ui` (**Remodl Core's** standard UI, `name: flowise-ui`) serves as a reference and its core components (especially the flow canvas) MAY BE leveraged or embedded by `packages/remodl-ui`. Direct modifications to `packages/ui` (the **Remodl Core** UI) should be minimized to facilitate easier upstream merges.
-   Rule: The **Remodl Core** backend is in `packages/server` (`name: flowise`). It's an Express.js application. Its APIs (prefixed `/api/v1`) are consumed by the Remodl AI Platform, typically via the Zuplo API Gateway.
-   Rule: Strategic modifications to `packages/server` (the **Remodl Core** server) ARE PERMISSIBLE if well-designed for: a. Enhancing **Remodl Core** engine extensibility for the Remodl AI Platform. b. Introducing clean hooks/interception points for platform integrations. c. Robust propagation of Remodl-specific context. All such changes MUST be documented, justified, and designed for minimal upstream conflict. Modifications solely for Remodl AI Platform business logic (that could reside in Supabase/Zuplo/custom nodes) MUST be avoided in `packages/server`.
-   Rule: Shared **Remodl Core** logic, node definitions, and interfaces reside in `packages/components` (`name: flowise-components`). Remodl-specific custom **Remodl Core** nodes (e.g., tools to interact with Supabase) MUST be developed within this package, following existing patterns for node creation.
-   Rule: **Remodl Core's** public API documentation is generated by `packages/api-documentation`. Internal API documentation for the Remodl AI Platform (covering necessary **Remodl Core** internal routes and Remodl AI Platform-specific endpoints via Zuplo) WILL BE created as a separate OpenAPI 3.1.0 specification (e.g., `remodl-core-internal-api-v1.yaml`).
-   Rule: Development environment: `pnpm dev` at root starts UI (Vite on e.g., :8080 with proxy to backend) and Server (Nodemon restarting Node.js server on e.g., :3000).
-   Rule: Production serving (standard **Remodl Core**): **Remodl Core** server serves its API and static UI assets from `packages/ui/build`. For Remodl AI Platform, `packages/remodl-ui` will likely be served independently (e.g., CDN) and interact with the Zuplo API gateway.

## 3. Code Standards

### Formatting
-   Rule: All TypeScript (.ts, .tsx) and Markdown (.md) files MUST adhere to the project's Prettier configuration (defined in root `package.json`).
-   Rule: Run `pnpm format` prior to committing changes.

### Linting
-   Rule: All JavaScript/TypeScript code MUST pass ESLint checks (config: root `.eslintrc.js`).
-   Rule: Address all ESLint errors and warnings. Use `pnpm lint` / `pnpm lint-fix`.
-   Rule: Unused imports and variables MUST be removed (ESLint: `unused-imports` plugin).
-   Rule: `console.log()` calls SHOULD be avoided for production code. `console.info()`, `console.warn()`, `console.error()` MAY be used for AI agent development debugging. CI will error on `console.log()`.

### Naming Conventions
-   Rule: Variables and function names: `camelCase`.
-   Rule: Classes, React components (PascalCase for .jsx/.tsx files), enums, and type aliases: `PascalCase`.
-   Rule: For interfaces, prefer `IPascalCase` (e.g., `interface INodeData {}`) when defining interfaces for **Remodl Core** components and core structures. For general type definitions, `PascalCase` is also acceptable.
-   Rule: Filenames for .ts/.tsx files SHOULD generally match the name of the primary class/component/module they export, using `PascalCase.ts` or `PascalCase.tsx` for components/classes and `camelCase.ts` or `feature.service.ts` for services/utilities.
-   Rule: Strive for clear, descriptive, and unambiguous names for all identifiers.

### Commenting
-   Rule: Provide JSDoc-style comments (`/** ... */`) for all public-facing functions, classes, methods, and complex type definitions, especially within `packages/components` (shared **Remodl Core** and Remodl Platform logic) and shared utilities.
-   Rule: Use single-line (`//`) or block (`/* ... */`) comments to explain non-obvious logic, complex algorithms, or important decisions within code blocks.
-   Rule: Avoid redundant comments that merely restate what the code clearly does.
-   Rule: Mark items for future attention with `// TODO:` or `// FIXME:` prefixes.

### Error Handling (Server-side: `packages/server` of **Remodl Core**)
-   Rule: Utilize `try...catch` blocks for operations that might fail.
-   Rule: When throwing custom errors, use or extend `InternalFlowiseError` from `src/errors/internalFlowiseError`, providing an appropriate `StatusCode` and descriptive message.
-   Rule: Service layer functions SHOULD throw errors; Controller layer functions SHOULD catch errors from services and format them or pass them to the global `errorHandlerMiddleware`.

### Logging (Server-side: `packages/server` of **Remodl Core**)
-   Rule: Use the centralized Winston logger (`src/utils/logger`) for all server-side logging.
-   Rule: Use appropriate log levels (`error`, `warn`, `info`, `debug`).

### TypeScript Best Practices
-   Rule: Prioritize strong typing; avoid `any` where possible.
-   Rule: Use `async/await` for asynchronous operations.
-   Rule: Define interfaces/types close to usage or in shared `Interface.ts`/`types.ts` files within modules where appropriate.

### React Best Practices (`packages/ui` of **Remodl Core**, and `packages/remodl-ui`)
-   Rule: Use functional components with hooks. Class components are legacy.
-   Rule: Use PropTypes (.jsx) or TypeScript types/interfaces (.tsx) for prop validation.
-   Rule: Use `React.memo`, `useMemo`, `useCallback` judiciously for performance.
-   Rule: Consider existing state management patterns (Redux, Context API in **Remodl Core** UI) for consistency or define a clear strategy if diverging in `packages/remodl-ui`.

## 4. Functionality Implementation Standards

-   Rule (Remodl Platform Features): New Remodl AI Platform-specific business logic (e.g., multi-tenancy, application management, user roles, feature flagging) MUST be implemented primarily within the Supabase backend. **Remodl Core** is an orchestrated engine.
-   Rule (Remodl UI Features): UI for Remodl Platform features MUST be in `packages/remodl-ui` (once created).
-   Rule (Integrating Remodl Logic into **Remodl Core**): Create custom nodes in `packages/components` to bridge Remodl AI Platform data/logic (from Supabase via Zuplo) into **Remodl Core** flows.
    -   *Example (Do):* Custom tool "FetchRemodlUserDetails" calling Supabase via Zuplo for use in a **Remodl Core** flow.
    -   *Example (Don't):* Embed direct Supabase DB connections in `packages/server` (the **Remodl Core** server).
-   Rule (**Remodl Core** Agent/Chatflow Development): When designing flows for Remodl Applications, utilize **Remodl Core** Agent Flow V2 capabilities.
-   Rule (API Design for Remodl Features): New API endpoints for Remodl AI Platform features (not direct **Remodl Core** operations) SHOULD be exposed via Zuplo, routing to Supabase or other Remodl services.

## 5. Framework/Plugin/Third-party Library Usage Standards

-   Rule (Dependency Management): Use PNPM (`pnpm install` from root). New dependencies/versions MUST be workspace-compatible.
-   Rule (Existing Frameworks - **Remodl Core**):
    -   Backend (`packages/server`): Express.js. New internal APIs (if essential for **Remodl Core** extensibility) follow existing patterns. TypeORM for **Remodl Core's** own database.
    -   Frontend (`packages/ui` and `packages/remodl-ui`): React, Vite. MUI is primary component library.
    -   AI/LLM Logic: Langchain.js is extensively used within **Remodl Core**. Custom nodes SHOULD use Langchain primitives.
-   Rule (Adding New Major Libraries): Introducing new major libraries/frameworks (especially impacting core architecture or build processes of **Remodl Core** or `packages/remodl-ui`) requires architectural review and approval.
-   Rule (Version Pinning/Updates): AI Agent MUST NOT arbitrarily update library versions. Adhere to versions in `remodel-v2-base` branch.

## 6. Workflow Standards

-   Rule (Development): Use `pnpm dev` (from project root).
-   Rule (Building): Use `pnpm build` (from project root).
-   Rule (Branching): New Remodl AI Platform features MUST be on branches from `remodel-v2-base`.
-   Rule (Committing): Use clear, descriptive commit messages (Conventional Commits preferred if adopted by team).
-   Rule (Dependency Installation): Use `pnpm install` (from project root).

## 7. Key File Interaction Standards

-   Rule (Monorepo Configuration): Adding new packages (like `packages/remodl-ui`) requires updates to `pnpm-workspace.yaml`, root `package.json` (`workspaces`), and potentially `turbo.json`.
-   Rule (UI Package Naming): When `packages/ui` is duplicated for `packages/remodl-ui`, its internal `package.json` `name` field MUST be changed (e.g., `@remodl/ui`).
-   Rule (Server Route Registration for **Remodl Core**): New `packages/server` API routes go in `src/routes/`, register in `src/routes/index.ts`. Controllers in `src/controllers/`, services in `src/services/`.
-   Rule (Component Registration - **Remodl Core** Nodes): New custom **Remodl Core** nodes for Remodl AI Platform features go in `packages/components/nodes/remodl/` (example path) and must be correctly exported/indexed.
-   Rule (Internal API Documentation): Document new/modified internal **Remodl Core** server APIs in `remodl-core-internal-api-v1.yaml` (OpenAPI 3.1.0).
-   Rule (Memory Bank Updates): Document significant architectural decisions, patterns, or task changes related to Remodl AI Platform in Memory Bank files using MCP Memory Bank tools.

## 8. AI Decision-making Standards

-   Rule (Prioritize Remodl Layers): For new Remodl AI Platform features: 1. Supabase logic. 2. Zuplo API. 3. `packages/remodl-ui`. 4. Custom **Remodl Core** nodes in `packages/components` as a bridge.
-   Rule (Minimize **Remodl Core** Changes): Direct modification of core **Remodl Core** files in `packages/server` (beyond approved extensibility points) or `packages/ui` (beyond theming/canvas integration for `remodl-ui`) is a LAST RESORT. Justify if platform layers/custom nodes are insufficient.
-   Rule (Upstream Compatibility): Permissible **Remodl Core** modifications MUST consider future merge compatibility with `FlowiseAI/Flowise` upstream. Aim for additive, clearly separated changes.
-   Rule (Tool Usage): AI Agent MUST use available MCP tools for context, progress tracking, and decision-making. Avoid assumptions.
-   Rule (Handling Ambiguity): If a task is ambiguous or conflicts with `rules.md`, use `process_thought` to analyze and propose resolution or seek clarification *before* implementation.

## 9. Prohibited Actions

-   Rule: DO NOT introduce breaking changes to the existing **Remodl Core** public API contracts (`packages/api-documentation/src/yml/swagger.yml`) without explicit directive.
-   Rule: DO NOT commit sensitive information (API keys, secrets) directly into the codebase.
-   Rule: DO NOT significantly alter the core build system (`turbo.json`, root `pnpm` scripts, Vite/TSC configs for core **Remodl Core** packages) without architectural approval.
-   Rule: DO NOT embed Remodl-specific business logic directly into `packages/server` (the **Remodl Core** server) if it can be housed in Supabase and accessed via platform APIs.
-   Rule: DO NOT introduce new core dependencies to **Remodl Core** packages (`server`, `ui`, `components`) without impact analysis. Prefer adding dependencies to `packages/remodl-ui` for custom platform UI features.