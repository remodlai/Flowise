"/chatmessage/": # Base path for POST is singular
  post:
    summary: "INTERNAL: Add Chat Message"
    description: "INTERNAL: Adds a new chat message to a specified chatflow and chat session."
    operationId: "internalChatMessagesAdd"
    tags: ["Chat Messages", "InternalAPI"]
    requestBody:
      required: true
      content:
        application/json:
          schema:
            # $ref: "#/components/schemas/ChatMessageCreateRequest" # To be defined
            type: object
            required:
              - role
              - chatflowid
              - content
              - chatType
              - chatId
            properties:
              role:
                type: string
                # enum: from MessageType
                description: "Role of the message sender."
              chatflowid:
                type: string
                format: uuid
                description: "ID of the parent chatflow."
              content:
                type: string
                description: "The message content."
              chatType:
                type: string
                # enum: from ChatType
                description: "Type of chat."
              chatId:
                type: string
                description: "ID of the chat session."
              executionId:
                type: string
                format: uuid
                nullable: true
              sourceDocuments:
                type: string
                description: "JSON string of source documents."
                nullable: true
              usedTools:
                type: string
                description: "JSON string of used tools."
                nullable: true
              fileAnnotations:
                type: string
                description: "JSON string of file annotations."
                nullable: true
              agentReasoning:
                type: string
                description: "JSON string of agent reasoning steps."
                nullable: true
              fileUploads:
                type: string
                description: "JSON string of file upload details."
                nullable: true
              artifacts:
                type: string
                description: "JSON string of artifacts."
                nullable: true
              action:
                type: string
                description: "JSON string of a tool action."
                nullable: true
              memoryType:
                type: string
                nullable: true
              sessionId:
                type: string
                nullable: true
              leadEmail:
                type: string
                nullable: true
              followUpPrompts:
                type: string
                description: "JSON string of suggested follow-up prompts."
                nullable: true
    responses:
      '200':
        description: "Chat message added successfully."
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ChatMessage" # To be defined
      '412':
        description: "Precondition Failed (e.g., missing request body)."
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ErrorResponse"
      '500':
        description: "Internal Server Error."
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ErrorResponse"
    # security:
    #   - InternalApiKeyAuth: []
