# Endpoint Analysis: POST /api/v1/leads/

**Module:** `leads`
**Operation ID:** `internalLeadsCreate`
**Description:** Creates a new lead record, typically captured from a chat session, associating it with a chatflow and a specific chat ID.

**Key Files:**
*   **Router:** `packages/server/src/routes/leads/index.ts`
*   **Controller:** `packages/server/src/controllers/leads/index.ts` (Handler: `createLead`)
*   **Service:** `packages/server/src/services/leads/index.ts` (Method: `createLead`)
*   **Entity:** `packages/server/src/database/entities/Lead.ts`

**Authentication:** Requires API Key.

**Request Body (`application/json`):**
*   `chatflowid` (string, format: uuid, required): ID of the chatflow this lead is associated with.
*   `chatId` (string, required): ID of the chat session from which this lead was generated.
*   `name?` (string, optional): Name of the lead.
*   `email?` (string, optional, format: email): Email address of the lead.
*   `phone?` (string, optional): Phone number of the lead.
*   *(Note: `id` and `createdDate` are auto-generated by the system.)*

*   **Example Request Body:**
    ```json
    {
      "chatflowid": "abc-123-def-456",
      "chatId": "xyz-789-uvw-012",
      "name": "John Doe",
      "email": "john.doe@example.com"
    }
    ```

**Responses:**

*   **`200 OK` (Success):**
    *   **Description:** Lead created successfully. Returns the created `Lead` entity.
    *   **Content (`application/json`):** Schema based on `Lead` entity (includes `id`, `name`, `email`, `phone`, `chatflowid`, `chatId`, `createdDate`).
*   **`400 Bad Request`:**
    *   **Description:** If `req.body` is not provided, or if essential fields like `chatflowid` or `chatId` are missing based on service/entity constraints (though controller only checks for `req.body` existence).
    *   **Content (`application/json`):** Schema `$ref: '#/components/schemas/ErrorResponse'`.
*   **`500 Internal Server Error`:**
    *   **Description:** Database error or other server-side issue during lead creation.
    *   **Content (`application/json`):** Schema `$ref: '#/components/schemas/ErrorResponse'`.

**Core Logic Summary:**
1. Controller (`createLead`) checks for `req.body`.
2. Creates a new `Lead` entity instance and assigns properties from `req.body`.
3. Calls `leadsService.createLead(newLead)`.
4. Service (`createLead`) saves the `Lead` entity to the database.
5. Service returns the saved entity.
6. Controller returns this as JSON.
